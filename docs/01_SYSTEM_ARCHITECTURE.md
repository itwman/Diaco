# سیستم مدیریت تولید دیاکو (Diaco MES)
## معماری سیستم و نقشه راه پروژه

**توسعه‌دهنده:** شرکت توسعه هوشمند فرش ایرانیان  
**مستقر در:** پارک علم و فناوری دانشگاه کاشان  
**وبسایت:** iranianc.com | **تلفن:** 031-55470630

---

## 1. خلاصه اجرایی (Executive Summary)

دیاکو یک سیستم MES (Manufacturing Execution System) تمام‌عیار برای صنعت ریسندگی و بافندگی است. این سیستم کل زنجیره تولید از الیاف خام تا نخ نهایی را پوشش می‌دهد:

```
الیاف خام → حلاجی (Blowroom) → کاردینگ (Carding) → پاساژ/کشش (Drawing) → فینیشر → رینگ (Ring Spinning) → نخ نهایی
```

---

## 2. معماری سطح بالا (High-Level Architecture)

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                          │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐ │
│  │   Desktop Web    │  │   Tablet UI      │  │   Mobile PWA     │ │
│  │  (Bootstrap RTL) │  │  (Big Buttons)   │  │  (Notifications) │ │
│  └────────┬─────────┘  └────────┬─────────┘  └────────┬─────────┘ │
│           │                     │                      │           │
│  ┌────────▼─────────────────────▼──────────────────────▼─────────┐ │
│  │              Django Template Engine (Jinja2)                   │ │
│  │              + Jalali Calendar + RTL + Vazir Font              │ │
│  └───────────────────────────┬───────────────────────────────────┘ │
└──────────────────────────────┼───────────────────────────────────┘
                               │
┌──────────────────────────────▼───────────────────────────────────┐
│                         API GATEWAY                               │
│  ┌───────────────────────────────────────────────────────────┐   │
│  │         Django REST Framework (DRF) + JWT Auth             │   │
│  │         Rate Limiting / Throttling / CORS                  │   │
│  └───────────────────────────┬───────────────────────────────┘   │
└──────────────────────────────┼───────────────────────────────────┘
                               │
┌──────────────────────────────▼───────────────────────────────────┐
│                      APPLICATION LAYER (DDD)                      │
│                                                                   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌────────────┐ │
│  │  accounts   │ │  inventory  │ │   orders    │ │   dyeing   │ │
│  │  (کاربران)  │ │  (انبار)    │ │  (سفارشات)  │ │  (رنگرزی)  │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └────────────┘ │
│                                                                   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌────────────┐ │
│  │   carding   │ │   passage   │ │  spinning   │ │maintenance │ │
│  │  (کاردینگ)  │ │  (پاساژ)    │ │   (رینگ)    │ │  (نت PM)   │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └────────────┘ │
│                                                                   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│  │  blowroom   │ │  finisher   │ │  dashboard  │                │
│  │  (حلاجی)    │ │  (فینیشر)   │ │ (داشبورد)   │                │
│  └─────────────┘ └─────────────┘ └─────────────┘                │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              SHARED KERNEL (core app)                        │ │
│  │  Base Models / Mixins / Batch Tracker / Audit Log           │ │
│  │  Jalali Utils / Notification Service / Permission Engine    │ │
│  └─────────────────────────────────────────────────────────────┘ │
└──────────────────────────────┼───────────────────────────────────┘
                               │
┌──────────────────────────────▼───────────────────────────────────┐
│                       DATA LAYER                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────────────┐ │
│  │   MySQL 8    │  │    Redis     │  │   File Storage         │ │
│  │  (Primary)   │  │  (Cache +    │  │  (Media / Reports)     │ │
│  │              │  │   Sessions)  │  │                        │ │
│  └──────────────┘  └──────────────┘  └────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    FUTURE AI LAYER (Phase 3+)                    │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────────────┐ │
│  │  Predictive  │  │     OEE      │  │   Quality Prediction   │ │
│  │ Maintenance  │  │   Analysis   │  │   & Anomaly Detection  │ │
│  └──────────────┘  └──────────────┘  └────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. جریان تولید صنعتی (Industrial Process Flow)

### 3.1 حلاجی (Blowroom)
الیاف فشرده خام (عدل‌ها) باز شده، تمیز و مخلوط می‌شوند. خروجی: الیاف آماده برای کاردینگ.
- **ورودی:** عدل الیاف (Fiber Bale) از انبار
- **پارامترها:** وزن ورودی، درصد ضایعات، نوع مخلوط
- **خروجی:** الیاف باز شده → تحویل به کاردینگ

### 3.2 کاردینگ (Carding)
الیاف به صورت فتیله (Sliver) موازی و یکنواخت می‌شوند.
- **ورودی:** الیاف از حلاجی
- **پارامترها:** سرعت ماشین (RPM)، نمره فتیله (Sliver Count/Nomreh)، زمان تمیزکاری، تولید (کیلوگرم)
- **خروجی:** فتیله (Sliver) → تحویل به پاساژ

### 3.3 پاساژ/کشش (Passage/Drawing) ⚠️ بحرانی
چند فتیله ترکیب و کشیده می‌شوند تا یکنواختی بهبود یابد. این مرحله **حیاتی** است چون بچ‌های مختلف ادغام می‌شوند.
- **ورودی:** 6-8 فتیله از کاردینگ (Multi-Input)
- **پارامترها:** نسبت کشش (Draft Ratio)، تعداد ورودی‌ها، نمره خروجی
- **خروجی:** 1 فتیله کشیده شده (Single-Output)
- **ردیابی بچ:** باید بتوان ردیابی کرد هر خروجی از ترکیب کدام بچ‌های ورودی ساخته شده

### 3.4 فینیشر (Finisher)
آخرین مرحله کشش و آماده‌سازی فتیله برای رینگ. مختصر تاب اولیه به فتیله داده می‌شود.
- **ورودی:** فتیله از پاساژ
- **پارامترها:** سرعت، نسبت کشش نهایی
- **خروجی:** فتیله نهایی → تحویل به رینگ

### 3.5 رینگ (Ring Spinning)
فتیله به نخ نهایی تبدیل می‌شود با تاب و کشش.
- **ورودی:** فتیله از فینیشر
- **پارامترها:** سرعت دوک (Spindle RPM)، تاب (Twist/Taab)، سیکل تعویض شیطانک (Traveler)
- **خروجی:** نخ نهایی (Yarn) → انبار محصول

---

## 4. ماژول‌های سیستم

### 4.1 ماژول‌های هسته (Core)
| ماژول | Django App | توضیح |
|-------|-----------|-------|
| هسته مشترک | `core` | مدل‌های پایه، Mixins، ابزار جلالی، سرویس اعلان |
| کاربران | `accounts` | احراز هویت JWT، نقش‌ها، دسترسی‌ها |
| داشبورد | `dashboard` | نمای کلی تولید، KPIها |

### 4.2 ماژول‌های تولید (Production)
| ماژول | Django App | توضیح |
|-------|-----------|-------|
| حلاجی | `blowroom` | ثبت ورودی الیاف، مخلوط‌سازی |
| کاردینگ | `carding` | سرعت، نمره، تمیزکاری، تولید |
| پاساژ | `passage` | ادغام بچ، نسبت کشش، ردیابی |
| فینیشر | `finisher` | کشش نهایی |
| رینگ | `spinning` | دوک، تاب، شیطانک |

### 4.3 ماژول‌های پشتیبانی (Support)
| ماژول | Django App | توضیح |
|-------|-----------|-------|
| انبار | `inventory` | الیاف، رنگ، اسید، FIFO، بچ/لات |
| سفارشات | `orders` | سفارش مشتری، تاریخچه تایید رنگ |
| رنگرزی | `dyeing` | دیگ بخار، خشک‌کن، مصرف مواد شیمیایی |
| نگهداری | `maintenance` | PM، برنامه سرویس، دلایل توقف |

---

## 5. نقشه راه (Roadmap)

### فاز 1: پایه و زیرساخت (هفته 1-3)
- [x] معماری سیستم و ERD
- [ ] راه‌اندازی پروژه Django
- [ ] یکپارچه‌سازی قالب Bootstrap RTL
- [ ] سیستم احراز هویت و نقش‌ها
- [ ] ماژول `core` (مدل‌های پایه)

### فاز 2: ماژول‌های اصلی (هفته 4-8)
- [ ] ماژول انبار (Inventory)
- [ ] ماژول سفارشات و رنگ (Orders)
- [ ] ماژول حلاجی (Blowroom)
- [ ] ماژول کاردینگ (Carding)
- [ ] ماژول پاساژ (Passage) - بحرانی
- [ ] ماژول فینیشر (Finisher)
- [ ] ماژول رینگ (Spinning)

### فاز 3: پشتیبانی و رابط کاربری (هفته 9-12)
- [ ] ماژول رنگرزی (Dyeing)
- [ ] ماژول نگهداری (Maintenance)
- [ ] رابط تبلت اپراتور
- [ ] داشبورد مدیریتی
- [ ] گزارش‌گیری

### فاز 4: هوش مصنوعی (آینده)
- [ ] پیش‌بینی نگهداری (Predictive Maintenance)
- [ ] تحلیل OEE
- [ ] تشخیص ناهنجاری کیفیت

---

## 6. پشته فنی (Tech Stack)

| لایه | فناوری |
|------|--------|
| Backend | Django 5.x LTS, Python 3.12 |
| API | Django REST Framework 3.15 |
| Auth | JWT (djangorestframework-simplejwt) |
| Database | MySQL 8.0 |
| Cache | Redis 7 |
| Frontend | Bootstrap 5 RTL (Kayo Admin Template) |
| Font | Vazirmatn (Farsi Digits) |
| Calendar | Jalali (django-jalali + JS picker) |
| Task Queue | Celery + Redis (for alerts) |

---

## 7. ساختار فولدری پروژه

```
C:\xampp\htdocs\Diaco\
├── config/                 # Django project settings
│   ├── settings/
│   │   ├── base.py
│   │   ├── development.py
│   │   └── production.py
│   ├── urls.py
│   ├── wsgi.py
│   └── asgi.py
├── apps/
│   ├── core/               # Shared kernel
│   ├── accounts/           # Users & Auth
│   ├── dashboard/          # Main dashboard
│   ├── inventory/          # Fiber, Dye, Acid stock
│   ├── orders/             # Customer orders & Color
│   ├── blowroom/           # حلاجی
│   ├── carding/            # کاردینگ
│   ├── passage/            # پاساژ/کشش
│   ├── finisher/           # فینیشر
│   ├── spinning/           # رینگ
│   ├── dyeing/             # رنگرزی
│   └── maintenance/        # PM نگهداری
├── templates/              # Django templates (from RTL template)
│   ├── base.html
│   ├── includes/
│   ├── accounts/
│   ├── dashboard/
│   └── ...
├── static/                 # Static files (from RTL/assets)
│   ├── css/
│   ├── js/
│   ├── vendor/
│   ├── fonts/
│   └── images/
├── media/                  # User uploads
├── RTL/                    # Original template (reference)
├── manage.py
├── requirements.txt
└── docs/                   # Documentation
```
